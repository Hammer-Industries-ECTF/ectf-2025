# Encoder
Python package for encoding frames for use with the Hammer Industries decoder

## Installation
This package requires Python >=3.10

To install the package using pip, do the following
```bash
cd /path/to/ectf/git/root
pip install ./design
```

## Secrets
Secrets come in the format of AES keys and initial values (IVs). The keys are 256 bits long and the IVs are 128 bits long. They are generated using the python function `token_bytes` from the `secrets` module.

### Usage
```
usage: gen_secrets.py [-h] [--force] secrets_file channels [channels ...]

positional arguments:
  secrets_file  Path to the secrets file to be created
  channels      Channel list for this deployment. Channel 0 is always valid and should not be entered here.

options:
  -h, --help    show this help message and exit
  --force, -f   Force creation of secrets file, overwriting existing file
```
Example: `py -m ectf25_design.gen_secrets ./test/global.secrets 1 2 3`

## Subscriptions
Subscriptions encode the channel ID, start and end timestamps, and the deocder ID that the subscription is valid for. It also encodes some checksum data to combat replacement-type attacks.

### Usage
```
usage: gen_subscription.py [-h] [--force] secrets_file subscription_file device_id start end channel

positional arguments:
  secrets_file       Path to the secrets file created by ectf25_design.gen_secrets
  subscription_file  Path to the subscription file to be generated
  device_id          Device ID of the update recipient
  start              Subscription start timestamp
  end                Subscription end timestamp
  channel            Channel to subscribe to

options:
  -h, --help         show this help message and exit
  --force, -f        Force creation of subscription file, overwriting existing file
```
Example: `py -m ectf25_design.gen_subscription ./test/global.secrets ./test/subscription.bin 0xdeadbeef 0 10000 1`

## Encode
Frames are encoded with metadata noting the channel ID, timestamp, and frame length of the frame. It also encodes some checksum data to combat replacement-type attacks.

### Usage
```
usage: ectf25_design.encoder [-h] secrets_file channel frame timestamp

positional arguments:
  secrets_file  Path to the secrets file generated by ectf25_design.gen_secrets
  channel       Channel to encode for
  frame         Contents of the frame
  timestamp     Timestamp of the frame

options:
  -h, --help    show this help message and exit
```
Example: `py -m ectf25_design.encoder ./test/global.secrets 1 "Frame Test Data" 3434`
